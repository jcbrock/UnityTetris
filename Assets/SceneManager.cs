//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.1022
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated. 
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using System.Collections;
namespace AssemblyCSharp
{
	public class SceneManager// : UnityEngine.MonoBehaviour
	{
		public Shape currentShape;
		public Block currentBlock;
		public Block tempBlock;
		public System.Collections.ArrayList listOfBlocks = new System.Collections.ArrayList ();
		public System.Collections.ArrayList listOfShapes = new System.Collections.ArrayList ();
		int[,] grid;
		//UnityEngine.Transform currentObject = UnityEngine.GameObject.Find("tempblock");
		//public UnityEngine.GameObject currentObject;// = UnityEngine.GameObject.Find ("tempblock");
				
		public SceneManager ()
		{
			grid = new int[10, 25];					
			currentBlock = new Block ();
						
			listOfBlocks.Add (new Block (UnityEngine.GameObject.Find ("tempblock")));
			listOfBlocks.Add (new Block (UnityEngine.GameObject.Find ("GameObject")));
			listOfBlocks.Add (new Block (UnityEngine.GameObject.Find ("TestCD2")));

			listOfShapes.Add (new Shape (UnityEngine.GameObject.Find ("tempblock")));
			listOfShapes.Add (new Shape (UnityEngine.GameObject.Find ("GameObject")));
			listOfShapes.Add (new Shape (UnityEngine.GameObject.Find ("TestCD2")));

			//currentShape = new Shape (UnityEngine.GameObject.Find ("TestCD"));
		}
			
		public void Tick ()
		{			
			//currentShape.Tick();
			//UnityEngine.Debug.Log (currentBlock.gameObject.transform.position);
			//currentBlock.Tick ();

			bool collided = false;
			if (AnyCollisions ()) {
				//listOfBlocks.Add (currentBlock); //might need to copy it explictly
				//currentBlock = new Block (SpawnRandomizedTetrisBlock ());
				listOfShapes.Add (currentShape); //might need to copy it explictly

				//currentShape.GetComponent<MyScript> ().enabled = false;
				//UnityEngine.Behaviour foop = (UnityEngine.Behaviour)(currentShape.compositeGameObject.GetComponent ("Script"));
				//foop.enabled = false;
				Shape thisIsDumb = currentShape;
				currentShape = new Shape (SpawnRandomizedTetrisBlock ());
				thisIsDumb.compositeGameObject.GetComponent <AssemblyCSharp.PlayerControl> ().enabled = false;
			} else {
				currentShape.compositeGameObject.transform.Translate (
									new UnityEngine.Vector3 (0, (float)-1, 0), UnityEngine.Space.World);								
				//currentShape.y -= 1;
			}
		}

		bool AnyCollisions ()
		{
			/*	foreach (Block block in listOfBlocks) { //for each object in the scene that is colliable
				if (CollisionManager.isColliding (currentBlock, block))
					return true;
			}*/
			foreach (Shape shape in listOfShapes) { //for each object in the scene that is colliable
				if (CollisionManager.isColliding (currentShape, shape))
					return true;
			}

			return false;
		}

		UnityEngine.GameObject SpawnRandomizedTetrisBlock ()
		{
			int foo = UnityEngine.Random.Range (0, 10); //10 = number of possible shapes
			float xStart = UnityEngine.Random.Range (0.0F, 10.0F); //10 = length of tetris board (x)
			int rotation = UnityEngine.Random.Range (0, 3); //Rotation possiblities
			UnityEngine.Debug.Log ("Random values! " + foo + " " + xStart + " " + rotation);
			UnityEngine.Vector3 temp = new UnityEngine.Vector3 (xStart, 0, 0);

			return SpawnNewBlock (currentShape.compositeGameObject, temp, rotation); //eventually replace with random shape...
		}
		
		UnityEngine.GameObject SpawnNewBlock (UnityEngine.GameObject objectShape, UnityEngine.Vector3 position, int rotation)
		{

			UnityEngine.GameObject newObj = (UnityEngine.GameObject)UnityEngine.MonoBehaviour.Instantiate (objectShape,
			                                             position,
			                                                                     UnityEngine.Quaternion.identity);
			//newObj.AddComponent ("CollisionManager");
						
			UnityEngine.Vector3 currentRotation;		
			currentRotation = newObj.transform.eulerAngles;
			currentRotation.z = (currentRotation.z + (90 * rotation * -1));
			newObj.transform.eulerAngles = currentRotation;
			return newObj;
		}



	}
}

